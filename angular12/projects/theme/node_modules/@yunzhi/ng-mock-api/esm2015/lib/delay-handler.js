import { of } from 'rxjs';
import { delay } from 'rxjs/operators';
import { HttpErrorResponse, HttpResponse } from '@angular/common/http';
import { randomNumber } from './utils';
/**
 * 延时处理器.
 */
export class DelayHandler {
    constructor() {
    }
    /**
     * 发生错误时延时调用error方法
     * @param message 错误信息
     * @param subscriber 订阅者
     */
    error(message, subscriber) {
        this.randomDelayCallback(() => {
            subscriber.error(new HttpErrorResponse({
                status: 0,
                error: message,
                statusText: 'network error'
            }));
            subscriber.complete();
        });
    }
    /**
     * 使用随机的延时返回数据
     * @param data 数据
     * @param subscriber 订阅者
     */
    next(data, subscriber) {
        this.randomDelayCallback(() => {
            subscriber.next(new HttpResponse({ body: data }));
            subscriber.complete();
        });
    }
    randomDelayCallback(callbackFn) {
        of(null).pipe(delay(randomNumber() % 6 * 100)).subscribe(() => {
            callbackFn();
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVsYXktaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL21vY2stYXBpL3NyYy9saWIvZGVsYXktaGFuZGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsRUFBRSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3hCLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUMsaUJBQWlCLEVBQWEsWUFBWSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFFaEYsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUdyQzs7R0FFRztBQUNILE1BQU0sT0FBTyxZQUFZO0lBRXZCO0lBQ0EsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxLQUFLLENBQUMsT0FBWSxFQUFFLFVBQXlDO1FBQzNELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLEVBQUU7WUFDNUIsVUFBVSxDQUFDLEtBQUssQ0FBQyxJQUFJLGlCQUFpQixDQUFDO2dCQUNyQyxNQUFNLEVBQUUsQ0FBQztnQkFDVCxLQUFLLEVBQUUsT0FBTztnQkFDZCxVQUFVLEVBQUUsZUFBZTthQUM1QixDQUFDLENBQUMsQ0FBQztZQUNKLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsSUFBSSxDQUFJLElBQU8sRUFBRSxVQUFvQztRQUNuRCxJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxFQUFFO1lBQzVCLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxZQUFZLENBQUMsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hELFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTyxtQkFBbUIsQ0FBQyxVQUFzQjtRQUNoRCxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQzVELFVBQVUsRUFBRSxDQUFDO1FBQ2YsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge29mfSBmcm9tICdyeGpzJztcbmltcG9ydCB7ZGVsYXl9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7SHR0cEVycm9yUmVzcG9uc2UsIEh0dHBFdmVudCwgSHR0cFJlc3BvbnNlfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQge0RlbGF5SGFuZGxlckludGVyZmFjZX0gZnJvbSAnLi9kZWxheS1oYW5kbGVyLmludGVyZmFjZSc7XG5pbXBvcnQge3JhbmRvbU51bWJlcn0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQge1N1YnNjcmliZXJ9IGZyb20gJ3J4anMvaW50ZXJuYWwvU3Vic2NyaWJlcic7XG5cbi8qKlxuICog5bu25pe25aSE55CG5ZmoLlxuICovXG5leHBvcnQgY2xhc3MgRGVsYXlIYW5kbGVyIGltcGxlbWVudHMgRGVsYXlIYW5kbGVySW50ZXJmYWNlIHtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgfVxuXG4gIC8qKlxuICAgKiDlj5HnlJ/plJnor6/ml7blu7bml7bosIPnlKhlcnJvcuaWueazlVxuICAgKiBAcGFyYW0gbWVzc2FnZSDplJnor6/kv6Hmga9cbiAgICogQHBhcmFtIHN1YnNjcmliZXIg6K6i6ZiF6ICFXG4gICAqL1xuICBlcnJvcihtZXNzYWdlOiBhbnksIHN1YnNjcmliZXI6IFN1YnNjcmliZXI8SHR0cEVycm9yUmVzcG9uc2U+KTogdm9pZCB7XG4gICAgdGhpcy5yYW5kb21EZWxheUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHN1YnNjcmliZXIuZXJyb3IobmV3IEh0dHBFcnJvclJlc3BvbnNlKHtcbiAgICAgICAgc3RhdHVzOiAwLFxuICAgICAgICBlcnJvcjogbWVzc2FnZSxcbiAgICAgICAgc3RhdHVzVGV4dDogJ25ldHdvcmsgZXJyb3InXG4gICAgICB9KSk7XG4gICAgICBzdWJzY3JpYmVyLmNvbXBsZXRlKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog5L2/55So6ZqP5py655qE5bu25pe26L+U5Zue5pWw5o2uXG4gICAqIEBwYXJhbSBkYXRhIOaVsOaNrlxuICAgKiBAcGFyYW0gc3Vic2NyaWJlciDorqLpmIXogIVcbiAgICovXG4gIG5leHQ8VD4oZGF0YTogVCwgc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxIdHRwRXZlbnQ8VD4+KTogdm9pZCB7XG4gICAgdGhpcy5yYW5kb21EZWxheUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHN1YnNjcmliZXIubmV4dChuZXcgSHR0cFJlc3BvbnNlKHtib2R5OiBkYXRhfSkpO1xuICAgICAgc3Vic2NyaWJlci5jb21wbGV0ZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByYW5kb21EZWxheUNhbGxiYWNrKGNhbGxiYWNrRm46ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICBvZihudWxsKS5waXBlKGRlbGF5KHJhbmRvbU51bWJlcigpICUgNiAqIDEwMCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICBjYWxsYmFja0ZuKCk7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==