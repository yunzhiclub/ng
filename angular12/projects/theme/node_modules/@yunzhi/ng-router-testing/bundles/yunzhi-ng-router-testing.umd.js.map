{"version":3,"file":"yunzhi-ng-router-testing.umd.js","sources":["../../../projects/router-testing/src/lib/activated-route.stub.ts","../../../projects/router-testing/src/lib/router.stub.ts","../../../projects/router-testing/src/lib/router-testing.module.ts","../../../projects/router-testing/src/public-api.ts","../../../projects/router-testing/src/yunzhi-ng-router-testing.ts"],"sourcesContent":["import {Observable, Subject} from 'rxjs';\nimport {tap} from 'rxjs/operators';\nimport {RouterStub} from './router.stub';\nimport {ActivatedRouteSnapshot, ActivationEnd, ParamMap, Params, Router} from '@angular/router';\nimport {Injectable} from '@angular/core';\n\n/**\n * 路由测试桩\n */\n@Injectable()\nexport class ActivatedRouteStub {\n  router: RouterStub;\n  paramsSubject = new Subject<Params>();\n  params: Observable<Params>;\n  paramMapSubject = new Subject<ParamMap>();\n  paramMap: Observable<ParamMap>;\n  queryParamsSubject = new Subject<Params>();\n  queryParams: Observable<Params>;\n  queryParamMapSubject = new Subject<ParamMap>();\n  queryParamsMap: Observable<ParamMap>\n\n  snapshot = {\n    paramMap: {\n      get: () => {\n        return 0;\n      }\n    }\n  };\n\n  /**\n   * 当有新路由参数时，弹出ActivationEnd事件，供在服务中通过Router获取全局路由信息\n   * 比如：实现回退功能时，需要对每个路由信息进行缓存\n   * @param router 路由\n   */\n  constructor(router: Router) {\n    this.router = router as unknown as RouterStub;\n    this.params = this.paramsSubject.asObservable();\n    this.paramMap = this.paramMapSubject.asObservable();\n    this.queryParams = this.queryParamsSubject.asObservable();\n    this.paramsSubject.pipe(tap(params => {\n      const activatedRouteSnapshot = new ActivatedRouteSnapshot();\n      activatedRouteSnapshot.params = params;\n      this.router.emitEvent(new ActivationEnd(activatedRouteSnapshot));\n    })).subscribe();\n    // 注册导航后的回调\n    this.router.registerNavigateCallbackFn((queryParams: Params) => {\n      this.queryParamsSubject.next(queryParams);\n    });\n  }\n}\n\nexport class ParamMapImpl implements ParamMap {\n  readonly keys: string[];\n  readonly values: { [key: string]: string | string[] };\n\n  get(name: string): string | null {\n    return this.values[name] as string;\n  }\n\n  getAll(name: string): string[] {\n    return this.values[name] as string[];\n  }\n\n  has(name: string): boolean {\n    return this.keys.indexOf(name) >= 0;\n  }\n\n  constructor(values: { [key: string]: string | string[] }) {\n    this.keys = [];\n    this.values = {};\n    for (const key in values) {\n      if (values[key] !== undefined) {\n        const value = values[key];\n        this.keys.push(key);\n        this.values[key] = value;\n      }\n    }\n  }\n}\n","import {Observable, Subject} from 'rxjs';\nimport {\n  ActivatedRoute,\n  Event,\n  NavigationExtras,\n  Params,\n  QueryParamsHandling,\n  UrlTree\n} from '@angular/router';\nimport {Injectable} from '@angular/core';\n\n@Injectable()\nexport class RouterStub {\n  /**\n   * An event stream for routing events in this NgModule.\n   */\n  readonly events: Observable<Event>;\n  /**\n   * 事件源\n   */\n  private readonly eventsSubject = new Subject<Event>();\n\n  private navigateCallbackFns = [] as ((queryParams: Params) => void)[];\n\n  constructor() {\n    this.events = this.eventsSubject.asObservable();\n  }\n\n  /**\n   * 增加该函数的目的仅为满足Ionic对route-link指令的处理\n   * @param commands 未知\n   * @param navigationExtras 未知\n   */\n  createUrlTree(commands: any[], navigationExtras: UrlCreationOptions = {}): UrlTree {\n    return {\n      root: null,\n      queryParams: null,\n      fragment: null,\n      queryParamMap: null,\n      toString(): string {\n        return '';\n      }\n    };\n  }\n\n  /**\n   * 弹出新事件\n   * @param event 事件\n   */\n  emitEvent(event: Event): void {\n    this.eventsSubject.next(event);\n  }\n\n  navigateByUrl(url: string | UrlTree, extras?: NavigationExtras): Promise<boolean> {\n    console.log('接收到了跳转请求', url, extras);\n    return Promise.resolve(true);\n  }\n\n  /**\n   * 跳转\n   * @param commands 参数\n   * @param extras 扩展属性\n   */\n  navigate(commands: any[], extras?: NavigationExtras): Promise<boolean> {\n    this.navigateCallbackFns.forEach(callback => callback(extras.queryParams));\n    return Promise.resolve(true);\n  }\n\n  /**\n   * 增加该函数的目的仅为满足Ionic对route-link指令的处理\n   * @param url 未知\n   */\n  serializeUrl(url: UrlTree): string {\n    return '';\n  }\n\n  /**\n   * 注册导航返回的回调\n   * @param fn 回调函数\n   */\n  registerNavigateCallbackFn(fn: (queryParams: Params) => void): void {\n    this.navigateCallbackFns.push(fn);\n  }\n}\n\ninterface UrlCreationOptions {\n  relativeTo?: ActivatedRoute | null;\n  queryParams?: Params | null;\n  fragment?: string;\n  queryParamsHandling?: QueryParamsHandling | null;\n  preserveFragment?: boolean;\n}\n\n","import {NgModule} from '@angular/core';\nimport {ActivatedRoute, Router} from '@angular/router';\nimport {RouterTestingModule as AngularRouterTestingModule} from '@angular/router/testing';\nimport {ActivatedRouteStub} from './activated-route.stub';\nimport {RouterStub} from './router.stub';\n\n\n@NgModule({\n  imports: [AngularRouterTestingModule],\n  providers: [\n    {provide: ActivatedRoute, useClass: ActivatedRouteStub},\n    {provide: Router, useClass: RouterStub},\n  ],\n  exports: [AngularRouterTestingModule]\n})\nexport class RouterTestingModule {\n}\n","/*\n * Public API Surface of router-testing\n */\nexport * from './lib/router-testing.module';\nexport * from './lib/router.stub';\nexport * from './lib/activated-route.stub';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["Subject","tap","ActivatedRouteSnapshot","ActivationEnd","Injectable","AngularRouterTestingModule","ActivatedRoute","Router","NgModule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAMA;;;;;;;;;QA4BE,4BAAY,MAAc;YAA1B,iBAcC;YApCD,kBAAa,GAAG,IAAIA,YAAO,EAAU,CAAC;YAEtC,oBAAe,GAAG,IAAIA,YAAO,EAAY,CAAC;YAE1C,uBAAkB,GAAG,IAAIA,YAAO,EAAU,CAAC;YAE3C,yBAAoB,GAAG,IAAIA,YAAO,EAAY,CAAC;YAG/C,aAAQ,GAAG;gBACT,QAAQ,EAAE;oBACR,GAAG,EAAE;wBACH,OAAO,CAAC,CAAC;qBACV;iBACF;aACF,CAAC;YAQA,IAAI,CAAC,MAAM,GAAG,MAA+B,CAAC;YAC9C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,EAAE,CAAC;YAChD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,CAAC;YACpD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,kBAAkB,CAAC,YAAY,EAAE,CAAC;YAC1D,IAAI,CAAC,aAAa,CAAC,IAAI,CAACC,aAAG,CAAC,UAAA,MAAM;gBAChC,IAAM,sBAAsB,GAAG,IAAIC,yBAAsB,EAAE,CAAC;gBAC5D,sBAAsB,CAAC,MAAM,GAAG,MAAM,CAAC;gBACvC,KAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAIC,gBAAa,CAAC,sBAAsB,CAAC,CAAC,CAAC;aAClE,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;;YAEhB,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,UAAC,WAAmB;gBACzD,KAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;aAC3C,CAAC,CAAC;SACJ;;;yIAtCU,kBAAkB;6IAAlB,kBAAkB;qHAAlB,kBAAkB;sBAD9BC,aAAU;;;QA0DT,sBAAY,MAA4C;YACtD,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;YACjB,KAAK,IAAM,GAAG,IAAI,MAAM,EAAE;gBACxB,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,SAAS,EAAE;oBAC7B,IAAM,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;oBAC1B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBACpB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;iBAC1B;aACF;SACF;QAtBD,0BAAG,GAAH,UAAI,IAAY;YACd,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAW,CAAC;SACpC;QAED,6BAAM,GAAN,UAAO,IAAY;YACjB,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAa,CAAC;SACtC;QAED,0BAAG,GAAH,UAAI,IAAY;YACd,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACrC;2BAaF;KAAA;;;QCtDC;;;;YAJiB,kBAAa,GAAG,IAAIJ,YAAO,EAAS,CAAC;YAE9C,wBAAmB,GAAG,EAAuC,CAAC;YAGpE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,EAAE,CAAC;SACjD;;;;;;QAOD,kCAAa,GAAb,UAAc,QAAe,EAAE,gBAAyC;YAAzC,iCAAA,EAAA,qBAAyC;YACtE,OAAO;gBACL,IAAI,EAAE,IAAI;gBACV,WAAW,EAAE,IAAI;gBACjB,QAAQ,EAAE,IAAI;gBACd,aAAa,EAAE,IAAI;gBACnB,QAAQ;oBACN,OAAO,EAAE,CAAC;iBACX;aACF,CAAC;SACH;;;;;QAMD,8BAAS,GAAT,UAAU,KAAY;YACpB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAChC;QAED,kCAAa,GAAb,UAAc,GAAqB,EAAE,MAAyB;YAC5D,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,EAAE,MAAM,CAAC,CAAC;YACrC,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SAC9B;;;;;;QAOD,6BAAQ,GAAR,UAAS,QAAe,EAAE,MAAyB;YACjD,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,UAAA,QAAQ,IAAI,OAAA,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,GAAA,CAAC,CAAC;YAC3E,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SAC9B;;;;;QAMD,iCAAY,GAAZ,UAAa,GAAY;YACvB,OAAO,EAAE,CAAC;SACX;;;;;QAMD,+CAA0B,GAA1B,UAA2B,EAAiC;YAC1D,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;SACnC;;;iIAtEU,UAAU;qIAAV,UAAU;qHAAV,UAAU;sBADtBI,aAAU;;;;QCIX;;;;0IAAa,mBAAmB;2IAAnB,mBAAmB,YAPpBC,2BAA0B,aAK1BA,2BAA0B;2IAEzB,mBAAmB,aANnB;YACT,EAAC,OAAO,EAAEC,iBAAc,EAAE,QAAQ,EAAE,kBAAkB,EAAC;YACvD,EAAC,OAAO,EAAEC,SAAM,EAAE,QAAQ,EAAE,UAAU,EAAC;SACxC,YAJQ,CAACF,2BAA0B,CAAC,EAK3BA,2BAA0B;qHAEzB,mBAAmB;sBAR/BG,WAAQ;uBAAC;wBACR,OAAO,EAAE,CAACH,2BAA0B,CAAC;wBACrC,SAAS,EAAE;4BACT,EAAC,OAAO,EAAEC,iBAAc,EAAE,QAAQ,EAAE,kBAAkB,EAAC;4BACvD,EAAC,OAAO,EAAEC,SAAM,EAAE,QAAQ,EAAE,UAAU,EAAC;yBACxC;wBACD,OAAO,EAAE,CAACF,2BAA0B,CAAC;qBACtC;;;ICdD;;;;ICAA;;;;;;;;;;;;;;;"}