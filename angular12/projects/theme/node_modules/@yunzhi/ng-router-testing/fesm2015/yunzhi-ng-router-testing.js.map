{"version":3,"file":"yunzhi-ng-router-testing.js","sources":["../../../projects/router-testing/src/lib/activated-route.stub.ts","../../../projects/router-testing/src/lib/router.stub.ts","../../../projects/router-testing/src/lib/router-testing.module.ts","../../../projects/router-testing/src/public-api.ts","../../../projects/router-testing/src/yunzhi-ng-router-testing.ts"],"sourcesContent":["import {Observable, Subject} from 'rxjs';\nimport {tap} from 'rxjs/operators';\nimport {RouterStub} from './router.stub';\nimport {ActivatedRouteSnapshot, ActivationEnd, ParamMap, Params, Router} from '@angular/router';\nimport {Injectable} from '@angular/core';\n\n/**\n * 路由测试桩\n */\n@Injectable()\nexport class ActivatedRouteStub {\n  router: RouterStub;\n  paramsSubject = new Subject<Params>();\n  params: Observable<Params>;\n  paramMapSubject = new Subject<ParamMap>();\n  paramMap: Observable<ParamMap>;\n  queryParamsSubject = new Subject<Params>();\n  queryParams: Observable<Params>;\n  queryParamMapSubject = new Subject<ParamMap>();\n  queryParamsMap: Observable<ParamMap>\n\n  snapshot = {\n    paramMap: {\n      get: () => {\n        return 0;\n      }\n    }\n  };\n\n  /**\n   * 当有新路由参数时，弹出ActivationEnd事件，供在服务中通过Router获取全局路由信息\n   * 比如：实现回退功能时，需要对每个路由信息进行缓存\n   * @param router 路由\n   */\n  constructor(router: Router) {\n    this.router = router as unknown as RouterStub;\n    this.params = this.paramsSubject.asObservable();\n    this.paramMap = this.paramMapSubject.asObservable();\n    this.queryParams = this.queryParamsSubject.asObservable();\n    this.paramsSubject.pipe(tap(params => {\n      const activatedRouteSnapshot = new ActivatedRouteSnapshot();\n      activatedRouteSnapshot.params = params;\n      this.router.emitEvent(new ActivationEnd(activatedRouteSnapshot));\n    })).subscribe();\n    // 注册导航后的回调\n    this.router.registerNavigateCallbackFn((queryParams: Params) => {\n      this.queryParamsSubject.next(queryParams);\n    });\n  }\n}\n\nexport class ParamMapImpl implements ParamMap {\n  readonly keys: string[];\n  readonly values: { [key: string]: string | string[] };\n\n  get(name: string): string | null {\n    return this.values[name] as string;\n  }\n\n  getAll(name: string): string[] {\n    return this.values[name] as string[];\n  }\n\n  has(name: string): boolean {\n    return this.keys.indexOf(name) >= 0;\n  }\n\n  constructor(values: { [key: string]: string | string[] }) {\n    this.keys = [];\n    this.values = {};\n    for (const key in values) {\n      if (values[key] !== undefined) {\n        const value = values[key];\n        this.keys.push(key);\n        this.values[key] = value;\n      }\n    }\n  }\n}\n","import {Observable, Subject} from 'rxjs';\nimport {\n  ActivatedRoute,\n  Event,\n  NavigationExtras,\n  Params,\n  QueryParamsHandling,\n  UrlTree\n} from '@angular/router';\nimport {Injectable} from '@angular/core';\n\n@Injectable()\nexport class RouterStub {\n  /**\n   * An event stream for routing events in this NgModule.\n   */\n  readonly events: Observable<Event>;\n  /**\n   * 事件源\n   */\n  private readonly eventsSubject = new Subject<Event>();\n\n  private navigateCallbackFns = [] as ((queryParams: Params) => void)[];\n\n  constructor() {\n    this.events = this.eventsSubject.asObservable();\n  }\n\n  /**\n   * 增加该函数的目的仅为满足Ionic对route-link指令的处理\n   * @param commands 未知\n   * @param navigationExtras 未知\n   */\n  createUrlTree(commands: any[], navigationExtras: UrlCreationOptions = {}): UrlTree {\n    return {\n      root: null,\n      queryParams: null,\n      fragment: null,\n      queryParamMap: null,\n      toString(): string {\n        return '';\n      }\n    };\n  }\n\n  /**\n   * 弹出新事件\n   * @param event 事件\n   */\n  emitEvent(event: Event): void {\n    this.eventsSubject.next(event);\n  }\n\n  navigateByUrl(url: string | UrlTree, extras?: NavigationExtras): Promise<boolean> {\n    console.log('接收到了跳转请求', url, extras);\n    return Promise.resolve(true);\n  }\n\n  /**\n   * 跳转\n   * @param commands 参数\n   * @param extras 扩展属性\n   */\n  navigate(commands: any[], extras?: NavigationExtras): Promise<boolean> {\n    this.navigateCallbackFns.forEach(callback => callback(extras.queryParams));\n    return Promise.resolve(true);\n  }\n\n  /**\n   * 增加该函数的目的仅为满足Ionic对route-link指令的处理\n   * @param url 未知\n   */\n  serializeUrl(url: UrlTree): string {\n    return '';\n  }\n\n  /**\n   * 注册导航返回的回调\n   * @param fn 回调函数\n   */\n  registerNavigateCallbackFn(fn: (queryParams: Params) => void): void {\n    this.navigateCallbackFns.push(fn);\n  }\n}\n\ninterface UrlCreationOptions {\n  relativeTo?: ActivatedRoute | null;\n  queryParams?: Params | null;\n  fragment?: string;\n  queryParamsHandling?: QueryParamsHandling | null;\n  preserveFragment?: boolean;\n}\n\n","import {NgModule} from '@angular/core';\nimport {ActivatedRoute, Router} from '@angular/router';\nimport {RouterTestingModule as AngularRouterTestingModule} from '@angular/router/testing';\nimport {ActivatedRouteStub} from './activated-route.stub';\nimport {RouterStub} from './router.stub';\n\n\n@NgModule({\n  imports: [AngularRouterTestingModule],\n  providers: [\n    {provide: ActivatedRoute, useClass: ActivatedRouteStub},\n    {provide: Router, useClass: RouterStub},\n  ],\n  exports: [AngularRouterTestingModule]\n})\nexport class RouterTestingModule {\n}\n","/*\n * Public API Surface of router-testing\n */\nexport * from './lib/router-testing.module';\nexport * from './lib/router.stub';\nexport * from './lib/activated-route.stub';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["AngularRouterTestingModule"],"mappings":"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"}
